<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <!-- <link rel="stylesheet" href="css/base.css" /> -->
  <script src="https://code.createjs.com/1.0.0/createjs.min.js"></script>
  <script>
    // 読み込みが終わってから初期化
    window.addEventListener("load", init);

    function init() {
        // ステージを作成
        var stage = new createjs.Stage("myCanvas");
        var w, h

        // リサイズイベントを検知してリサイズ処理を実行
        window.addEventListener("resize", handleResize);
        handleResize(); // 起動時にもリサイズしておく

        // リサイズ処理
        function handleResize(event) {
            // 画面幅・高さを取得
            w = window.innerWidth;
            h = window.innerHeight;
            // Canvas要素の大きさを画面幅・高さに合わせる
            stage.canvas.width = w;
            stage.canvas.height = h;
            // 画面更新する
            stage.update();
        }

        // タッチ操作をサポートしているブラウザーならば
        if (createjs.Touch.isSupported() == true) {
        // タッチ操作を有効にします。
        createjs.Touch.enable(stage)
        }



        // オブジェクトの作成
        var rect = new createjs.Shape();
        rect.graphics.beginFill("black").drawRect(0, 0, w, h);
        stage.addChild(rect);

        var move_point = new MovePoint();
        stage.addChild(move_point);

        var object_a = new MoveObject();
        stage.addChild(object_a);


        // tick イベントを登録する
        createjs.Ticker.addEventListener("tick", handleTick);
        createjs.Ticker.timingMode = createjs.Ticker.RAF;

        // 各種マウスイベントを登録する
        rect.addEventListener("click", handleRectClick);

        function handleTick(event) {
            

            // 画面を更新する
            stage.update();
        }

        //背景クリックイベント
        function handleRectClick(event) {
          move_point.transfar(stage.mouseX, stage.mouseY);
          object_a.set_destination(stage.mouseX, stage.mouseY)
        }
 
    } //init()ここまで


    //---------------- class ----------------//
    class MovePoint extends createjs.Shape {
      constructor() {
        super();
        
        this.graphics.beginStroke("white");
        this.graphics.setStrokeStyle(5);
        this.graphics.drawCircle(0, 0, 40);
      }

      transfar(_x, _y) {
        this.x = _x;
        this.y = _y;
      }
    }

    class MoveObject extends createjs.Container {
      constructor() {
        super();
        
        this.speed = 2;
        this.vx = 0;
        this.vy = 0;

        var shape = new createjs.Shape();
        shape.graphics.beginFill('white');
        shape.graphics.drawCircle(0, 0, 30);
        this.addChild(shape); // 表示リストに追加

        // メンバーフィールドに保存
        this.shape = shape;

        // 更新イベントを定義
        this.on('tick', this.update, this);
      }

      set_destination(dest_x, dest_y){
        var angle = Math.atan2(dest_y-this.y, dest_x-this.x );
        this.vx = this.speed * Math.cos(angle);
        this.vy = this.speed * Math.sin(angle);
      }

      

      update() {
        this.x += this.vx;
        this.y += this.vy;
      }
    }

    
  </script>
  <style>
    canvas#myCanvas {
      display: block;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <canvas id="myCanvas">
  </canvas>
</body>
</html>